<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
font-family:'Poppins',sans-serif;
background:linear-gradient(-45deg,#ff9a9e,#fecfef,#fad0c4,#fbc2eb);
background-size:400% 400%;
animation:gradientBG 12s ease infinite;
padding:20px;
margin:0;
}
@keyframes gradientBG{
0%{background-position:0% 50%;}
50%{background-position:100% 50%;}
100%{background-position:0% 50%;}
}

.top-bar{
display:flex;
justify-content:space-between;
align-items:center;
flex-wrap:wrap;
margin-bottom:15px;
}

h2{color:#d63384;margin-bottom:10px;}

.logout-btn{
background:#ff4d6d;
color:white;
border:none;
padding:8px 15px;
border-radius:20px;
cursor:pointer;
font-weight:600;
transition:0.3s;
}
.logout-btn:hover{transform:translateY(-2px);}

.search-box{
margin-bottom:15px;
width:100%;
text-align:center;
}
.search-box input{
padding:10px;
width:90%;
max-width:400px;
border-radius:20px;
border:none;
outline:none;
}

.tabs{
display:flex;
justify-content:center;
flex-wrap:wrap;
margin-bottom:10px;
}
.tab-btn{
padding:8px 15px;
border:none;
cursor:pointer;
background:#ffd6e8;
margin:5px;
border-radius:20px;
font-weight:600;
transition:0.3s;
}
.tab-btn.active{
background:#ff4da6;
color:white;
}

.rating-tabs{
text-align:center;
margin-bottom:15px;
}
.rating-btn{
padding:6px 12px;
margin:4px;
border:none;
border-radius:15px;
cursor:pointer;
background:#ffe6f2;
}
.rating-btn.active{
background:#ff85c1;
color:white;
}

.delete-container{
text-align:center;
margin-bottom:10px;
}

.delete-btn{
display:none;
background:#ff1744;
color:white;
border:none;
padding:8px 15px;
border-radius:20px;
cursor:pointer;
font-weight:600;
}

table{
width:100%;
border-collapse:collapse;
background:white;
border-radius:15px;
overflow:hidden;
box-shadow:0 8px 20px rgba(255,0,150,0.3);
table-layout:fixed;
word-wrap:break-word;
}

th,td{
padding:10px;
text-align:center;
font-size:14px;
}
th{
background:#ff4da6;
color:white;
}
tr:nth-child(even){background:#ffe6f2;}

.status-select{
padding:5px;
border-radius:8px;
border:none;
background:#ffe6f2;
width:100%;
}

.star{
color:#ff4da6;
font-size:16px;
}

@media screen and (max-width: 800px){
table, thead, tbody, th, td, tr{
display:block;
}

thead tr{display:none;}

tr{
margin-bottom:15px;
border-radius:15px;
background:white;
box-shadow:0 6px 15px rgba(255,0,150,0.2);
padding:10px;
}

td{
text-align:left;
padding:5px 10px;
position:relative;
}

td::before{
content:attr(data-label);
position:absolute;
left:10px;
font-weight:600;
color:#d63384;
}
.status-select{width:90%;}
}
</style>
</head>

<body>

<div class="top-bar">
<h2>ðŸ“Š Admin Dashboard</h2>
<button class="logout-btn" onclick="logout()">Logout</button>
</div>

<div class="search-box">
<input type="text" id="searchInput" placeholder="Search Hospital / Patient / Issue..." onkeyup="loadFeedback()">
</div>

<div class="tabs">
<button class="tab-btn active" onclick="switchTab('Pending',this)">Pending</button>
<button class="tab-btn" onclick="switchTab('In Progress',this)">In Progress</button>
<button class="tab-btn" onclick="switchTab('Solved',this)">Solved</button>
</div>

<div class="rating-tabs">
<button class="rating-btn active" onclick="filterRating(0,this)">All</button>
<button class="rating-btn" onclick="filterRating(1,this)">1â˜…</button>
<button class="rating-btn" onclick="filterRating(2,this)">2â˜…</button>
<button class="rating-btn" onclick="filterRating(3,this)">3â˜…</button>
<button class="rating-btn" onclick="filterRating(4,this)">4â˜…</button>
<button class="rating-btn" onclick="filterRating(5,this)">5â˜…</button>
</div>

<div class="delete-container">
<button id="deleteBtn" class="delete-btn" onclick="deleteSelected()">ðŸ—‘ Delete Selected</button>
</div>

<table>
<thead>
<tr>
<th>Select</th>
<th>ID</th>
<th>Hospital</th>
<th>Patient</th>
<th>Issue</th>
<th>Feedback</th>
<th>Rating</th>
<th>Status</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
const supabaseClient = supabase.createClient(
"https://zhnamyobwlyrommgpedi.supabase.co",
"sb_publishable_FKBkWP3UPo-Qtobv7gjW4A_gvNxLsFh"
);

let currentStatus="Pending";
let currentRating=0;

async function loadFeedback(){

let query = supabaseClient
.from("Feedback")
.select("*")
.eq("FeedbackStatus", currentStatus)
.order("id",{ascending:false});

if(currentRating>0)
query=query.eq("Rating",currentRating);

const { data, error } = await query;

if(error){
alert("Error loading data");
return;
}

const searchValue = document.getElementById("searchInput").value.toLowerCase();
const tableBody = document.getElementById("tableBody");
tableBody.innerHTML="";

data.forEach(row=>{

if(
row.HospitalName.toLowerCase().includes(searchValue) ||
row.PatientName.toLowerCase().includes(searchValue) ||
row.PatientIssue.toLowerCase().includes(searchValue)
){

const stars="â˜…".repeat(row.Rating||0);

tableBody.innerHTML+=`
<tr>
<td data-label="Select">
<input type="checkbox" class="row-checkbox" value="${row.id}" onchange="toggleDeleteButton()">
</td>
<td data-label="ID">${row.id}</td>
<td data-label="Hospital">${row.HospitalName}</td>
<td data-label="Patient">${row.PatientName}</td>
<td data-label="Issue">${row.PatientIssue}</td>
<td data-label="Feedback">${row.PatientFeedback}</td>
<td data-label="Rating" class="star">${stars}</td>
<td data-label="Status">
<select class="status-select" onchange="updateStatus(${row.id},this.value)">
<option value="Pending" ${row.FeedbackStatus=="Pending"?"selected":""}>Pending</option>
<option value="In Progress" ${row.FeedbackStatus=="In Progress"?"selected":""}>In Progress</option>
<option value="Solved" ${row.FeedbackStatus=="Solved"?"selected":""}>Solved</option>
</select>
</td>
</tr>
`;
}

});

document.getElementById("deleteBtn").style.display="none";
}

function switchTab(status,btn){
currentStatus=status;
document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
loadFeedback();
}

function filterRating(rating,btn){
currentRating=rating;
document.querySelectorAll(".rating-btn").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
loadFeedback();
}

function toggleDeleteButton(){
const checked=document.querySelectorAll(".row-checkbox:checked").length;
document.getElementById("deleteBtn").style.display=checked>0?"inline-block":"none";
}

async function deleteSelected(){

const selected=Array.from(document.querySelectorAll(".row-checkbox:checked"))
.map(cb=>parseInt(cb.value));

if(selected.length===0) return;

if(!confirm("Are you sure you want to delete selected feedback?")) return;

const { error } = await supabaseClient
.from("Feedback")
.delete()
.in("id",selected);

if(error){
alert("Error deleting data");
}else{
alert("Deleted successfully!");
loadFeedback();
}
}

async function updateStatus(id,newStatus){
await supabaseClient.from("Feedback")
.update({FeedbackStatus:newStatus})
.eq("id",id);
loadFeedback();
}

function logout(){
alert("Logged out successfully!");
window.location.href="index.html";
}

loadFeedback();
</script>

</body>
</html>
